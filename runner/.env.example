# Example configuration for Esup-Runner Runner
# Copy to .env and adapt to your environment.
#
#   cp .env.example .env
#   nano .env

# DEBUG mode
DEBUG=False

# Runner/Multi-instance configuration
RUNNER_PROTOCOL=http
RUNNER_HOST=127.0.0.1
RUNNER_BASE_PORT=8082
RUNNER_BASE_NAME=my-runner

# Runner/Multi-instance configuration
# With grouped syntax in RUNNER_TASK_TYPES, the total number of instances is derived automatically.
# (You may keep RUNNER_INSTANCES, but it should match the computed total to avoid a warning.)
RUNNER_INSTANCES=1
# Task types managed by this runner
# Legacy syntax: encoding,studio,transcription (applies to all instances)
# Grouped syntax: [2x(encoding,studio,transcription),1x(encoding,studio),1x(transcription)]
RUNNER_TASK_TYPES=[1x(encoding,studio,transcription)]

# Monitor instances and automatically restart failed ones
RUNNER_MONITORING=False

# Manager URL configuration
MANAGER_URL=http://127.0.0.1:8081

# API token authentication
# - RUNNER_TOKEN: must match an authorised token in the manager
#   (and is also used to validate manager calls to this runner after registration)
RUNNER_TOKEN=change-me-runner-token

# CORS (Runner API)
# Comma-separated list; keep "*" only if CORS_ALLOW_CREDENTIALS=false.
CORS_ALLOW_ORIGINS=*
CORS_ALLOW_CREDENTIALS=false
CORS_ALLOW_METHODS=*
CORS_ALLOW_HEADERS=*

# Outbound downloads (sources/assets)
# - DOWNLOAD_ALLOWED_HOSTS: optional allowlist (comma-separated). Empty means allow any.
# - DOWNLOAD_ALLOW_PRIVATE_NETWORKS: keep true for internal deployments; set false to mitigate SSRF to RFC1918/loopback.
DOWNLOAD_ALLOWED_HOSTS=
DOWNLOAD_ALLOW_PRIVATE_NETWORKS=true

# Optional email/SMTP notifications (if enabled by your deployment)
#  - SMTP_SERVER: address of the SMTP server (e.g., smtp.example.org)
#  - SMTP_PORT: port of the SMTP server (e.g., 25 or 587)
#  - SMTP_USE_TLS: enable STARTTLS for encrypted SMTP connection (true/false)
#  - SMTP_USERNAME: SMTP authentication username (optional)
#  - SMTP_PASSWORD: SMTP authentication password (optional)
#  - SMTP_SENDER: email address used as sender for notifications
#  - MANAGER_EMAIL: email address of the manager to receive notifications
# SMTP_SERVER=smtp.example.org
# SMTP_PORT=587
# SMTP_USE_TLS=true
# SMTP_USERNAME=
# SMTP_PASSWORD=
# SMTP_SENDER=esup-runner@example.org
# MANAGER_EMAIL=admin@example.org

# Logs
LOG_DIRECTORY=/var/log/esup-runner
LOG_LEVEL=INFO

# Workspace and storage configuration
#  - STORAGE_DIR: directory for temporary files during processing (make sure it has enough space and proper permissions)
#  - MAX_VIDEO_SIZE_GB: maximum video size in GB for processing (0 for unlimited)
#  - MAX_FILE_AGE_DAYS: maximum age of files in storage in days (0 for unlimited)
#  - CLEANUP_INTERVAL_HOURS: interval for periodic cleanup in hours
STORAGE_DIR=/tmp/esup-runner
MAX_VIDEO_SIZE_GB=0
MAX_FILE_AGE_DAYS=7
CLEANUP_INTERVAL_HOURS=24

# Encoding type (CPU or GPU): set to GPU to enable GPU encoding (make sure your system is properly configured with NVIDIA drivers and CUDA)
ENCODING_TYPE=CPU

# Specifics settings for GPU encoding
# - GPU_CUDA_VISIBLE_DEVICES: specify which GPUs to use for encoding (e.g., 0,1 for the first two GPUs)
# - GPU_CUDA_DEVICE_ORDER: specify the order of devices (e.g., PCI_BUS_ID to order by PCI bus ID)
# - GPU_CUDA_PATH: specify the path to CUDA installation if not in default location (e.g., /usr/local/cuda-13.2)
# GPU_CUDA_VISIBLE_DEVICES=0
# GPU_CUDA_DEVICE_ORDER=PCI_BUS_ID
# GPU_CUDA_PATH=/usr/local/cuda-13.2

# Default encoding settings for STUDIO tasks
#  - STUDIO_DEFAULT_CRF: Compression rate factor (CRF) for video encoding
#  - STUDIO_DEFAULT_PRESET: Preset for video encoding (ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow)
#  - STUDIO_DEFAULT_AUDIO_BITRATE: Audio bitrate for audio encoding
STUDIO_DEFAULT_CRF=20
STUDIO_DEFAULT_PRESET=slow
STUDIO_DEFAULT_AUDIO_BITRATE=192k

# Transcription (Whisper) settings
# - WHISPER_MODEL: Whisper model to use for transcription (tiny, base, small, medium, large, turbo)
# - WHISPER_MODELS_DIR: Directory to store Whisper models (default: ~/.cache/esup-runner/whisper-models)
# - WHISPER_LANGUAGE: Language for transcription (auto for automatic detection, or specify a language code like en, fr, etc.)
WHISPER_MODEL=turbo
WHISPER_MODELS_DIR=/home/user/.cache/esup-runner/whisper-models
WHISPER_LANGUAGE=auto
